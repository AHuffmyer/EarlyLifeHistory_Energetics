---
title: Early life history physiology correlations  
author: "AS Huffmyer"
date: '2020'
output:
  html_document:
    code_folding: hide
    toc: yes
    toc_depth: 6
    toc_float: yes
  pdf_document:
    keep_tex: yes
editor_options: 
  chunk_output_type: console
---
This script generates combined data frame of early life history size and symbiont density data.  m

# **Setup**  

Load libraries.  

```{r}
if ("tidyverse" %in% rownames(installed.packages()) == 'FALSE') install.packages('tidyverse') 
if ("ggplot2" %in% rownames(installed.packages()) == 'FALSE') install.packages('ggplot2') 
if ("GGally" %in% rownames(installed.packages()) == 'FALSE') install.packages('GGally') 

library(tidyverse)
library(ggplot2)
library(GGally)
```

# **Load dataframes**  

```{r}
resp<-read.csv("Mcap2020/Output/Respiration/mean_respiration.csv")
size<-read.csv("Mcap2020/Output/Physiology/larval_size_table.csv")
size_density<-read.csv("Mcap2020/Output/Physiology/normalized_size_cells_summary.csv")
density<-read.csv("Mcap2020/Output/Physiology/cell_density_table.csv")
```

Standardize column names.  

```{r}
resp<-resp%>%
    rename(Lifestage=group)%>%
    dplyr::select(Lifestage, Mean_R, Mean_GP, Mean_PR)

levels(resp$Lifestage) <- list(`Larvae 2`  = "Larvae2", `Larvae 3`  = "Larvae3", `Larvae 5`  = "Larvae5",`Larvae 6`  = "Larvae6", `Recruit 1`  = "Recruit1", `Recruit 2`  = "Recruit2")
  
size<-size%>%
  dplyr::select(Lifestage, Mean)%>%
  rename(Mean_Size=Mean)

size_density<-size_density%>%
  dplyr::select(lifestage, Mean)%>%
  rename(Mean_Size_Density=Mean, Lifestage=lifestage)

density<-density%>%
    rename(Lifestage=lifestage, Mean_Density=Mean)%>%
  dplyr::select(Lifestage, Mean_Density)
```

Combine dataframes.  

```{r}
master<-full_join(resp, size, by=c("Lifestage"))

master<-full_join(master, size_density, by=c("Lifestage"))

master<-full_join(master, density, by=c("Lifestage"))

```

Calculate size normalized respiration for comparison.  

```{r}
master<-master%>%
  mutate(Mean_R_Area=(Mean_R)/Mean_Size)%>%
  mutate(Mean_GP_Area=(Mean_GP)/Mean_Size)
```


# **Generate correlation matrix**

Check for correlations between all variables.  
```{r}
master%>%
  ggpairs(., columns=2:9)

```

There is a significant correlation between size normalized symbiont cell density and respiration. Plot this relationship.  

Run Pearson correlation between respiration and size normalized cell densities.  

```{r}
cor<-master%>%
  drop_na()

results<-cor.test(cor$Mean_Size_Density, cor$Mean_R, method=c("pearson"))
results
```

```{r}
correlation<-master %>%
    drop_na()%>%
    ggplot(., aes(x = Mean_Size_Density, y = Mean_R)) +
    #geom_smooth(method="glm", se=FALSE, fullrange=TRUE, level=0.95, color="gray", fill="gray") +
    geom_point(aes(fill=Lifestage), pch = 21, size=4) + 
    xlab(expression(bold(paste("Symbiont cells mm"^-2)))) + 
    scale_fill_manual(name="Lifestage", values=c("#DFC27D", "#80CDC1","#80CDC1", "#80CDC1", "#003C30", "#003C30"))+
    scale_color_manual(name="Lifestage", values=c("#DFC27D", "#80CDC1","#80CDC1", "#80CDC1", "#003C30", "#003C30"))+
    ylab(expression(bold(paste("Respiration (nmol O2) individual"^-1))))+
    #ylim(0, 9000)+
    theme_classic() + 
    theme(
      legend.position="right",
      axis.title=element_text(face="bold", size=14),
      axis.text=element_text(size=12, color="black"), 
      legend.title=element_text(face="bold", size=14)
      ); correlation

ggsave(plot=correlation, "Mcap2020/Figures/Physiology/R_Density_Correlation.png")
```

Run Pearson correlation between area normalized respiration and size normalized cell densities.  

```{r}
results<-cor.test(cor$Mean_Size_Density, cor$Mean_R_Area, method=c("pearson"))
results
```

```{r}
correlation<-master %>%
    drop_na()%>%
    ggplot(., aes(x = Mean_Size_Density, y = Mean_R_Area)) +
    #geom_smooth(method="glm", se=FALSE, fullrange=TRUE, level=0.95, color="gray", fill="gray") +
    geom_point(aes(fill=Lifestage), pch = 21, size=4) + 
    xlab(expression(bold(paste("Symbiont cells mm"^-2)))) + 
    scale_fill_manual(name="Lifestage", values=c("#DFC27D", "#80CDC1","#80CDC1", "#80CDC1", "#003C30", "#003C30"))+
    scale_color_manual(name="Lifestage", values=c("#DFC27D", "#80CDC1","#80CDC1", "#80CDC1", "#003C30", "#003C30"))+
    ylab(expression(bold(paste("Respiration (nmol O2) mm"^-2))))+
    #ylim(0, 9000)+
    theme_classic() + 
    theme(
      legend.position="right",
      axis.title=element_text(face="bold", size=14),
      axis.text=element_text(size=12, color="black"), 
      legend.title=element_text(face="bold", size=14)
      ); correlation

ggsave(plot=correlation, "Mcap2020/Figures/Physiology/R_Area_Density_Correlation.png")
```